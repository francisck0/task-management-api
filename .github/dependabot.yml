# ============================================================================
# DEPENDABOT CONFIGURATION
# ============================================================================
#
# Dependabot mantiene automáticamente las dependencias actualizadas.
#
# BENEFICIOS:
# - Actualizaciones automáticas de dependencias
# - PRs automáticos con changelogs
# - Detección de vulnerabilidades de seguridad
# - Compatible con Gradle, Docker, GitHub Actions
#
# DOCUMENTACIÓN:
# https://docs.github.com/en/code-security/dependabot/dependabot-version-updates
#
# ============================================================================

version: 2

updates:
  # ==========================================================================
  # GRADLE - Dependencias de Java/Spring Boot
  # ==========================================================================
  - package-ecosystem: "gradle"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "Europe/Madrid"

    # Número máximo de PRs abiertos simultáneamente
    open-pull-requests-limit: 10

    # Estrategia de versionado
    versioning-strategy: increase

    # Prefijo para commits y PRs
    commit-message:
      prefix: "chore(deps)"
      include: "scope"

    # Labels para PRs
    labels:
      - "dependencies"
      - "gradle"
      - "automated"

    # Reviewers automáticos (opcional - descomentar y agregar usuarios)
    # reviewers:
    #   - "username1"
    #   - "username2"

    # Asignees automáticos (opcional)
    # assignees:
    #   - "username1"

    # Agrupar actualizaciones por tipo
    groups:
      # Grupo: Actualizaciones de Spring Boot
      spring:
        patterns:
          - "org.springframework.boot:*"
          - "org.springframework:*"
          - "org.springframework.security:*"
          - "org.springframework.data:*"
        update-types:
          - "minor"
          - "patch"

      # Grupo: Actualizaciones de dependencias de testing
      testing:
        patterns:
          - "org.junit.jupiter:*"
          - "org.mockito:*"
          - "org.assertj:*"
          - "com.h2database:*"
        update-types:
          - "minor"
          - "patch"

      # Grupo: Actualizaciones de herramientas de desarrollo
      development:
        patterns:
          - "org.projectlombok:*"
          - "org.mapstruct:*"
        update-types:
          - "minor"
          - "patch"

    # Ignorar ciertas dependencias (ejemplo)
    # ignore:
    #   - dependency-name: "org.springframework.boot:spring-boot-starter-parent"
    #     versions: ["3.0.x"]

    # Permitir solo ciertos tipos de actualizaciones
    # allow:
    #   - dependency-type: "direct"
    #   - dependency-type: "production"

  # ==========================================================================
  # DOCKER - Imágenes base en Dockerfile
  # ==========================================================================
  - package-ecosystem: "docker"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "Europe/Madrid"

    open-pull-requests-limit: 5

    commit-message:
      prefix: "chore(docker)"

    labels:
      - "dependencies"
      - "docker"
      - "automated"

    # Solo actualizaciones de seguridad para imágenes Docker (más conservador)
    # versioning-strategy: auto

  # ==========================================================================
  # GITHUB ACTIONS - Workflows y actions
  # ==========================================================================
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "Europe/Madrid"

    open-pull-requests-limit: 5

    commit-message:
      prefix: "chore(ci)"

    labels:
      - "dependencies"
      - "github-actions"
      - "ci-cd"
      - "automated"

# ============================================================================
# CONFIGURACIÓN ADICIONAL RECOMENDADA
# ============================================================================
#
# 1. GITHUB SETTINGS > Security > Code security and analysis:
#    ✓ Dependabot alerts: Enabled
#    ✓ Dependabot security updates: Enabled
#    ✓ Dependabot version updates: Enabled (configurado en este archivo)
#
# 2. BRANCH PROTECTION RULES:
#    - Requiere que CI pase antes de merge
#    - Requiere reviews para PRs de Dependabot
#    - Auto-merge para actualizaciones menores (opcional)
#
# 3. AUTO-MERGE DE DEPENDABOT (opcional):
#    Crear workflow .github/workflows/dependabot-auto-merge.yml:
#
#    name: Dependabot Auto-Merge
#    on: pull_request
#    permissions:
#      pull-requests: write
#      contents: write
#    jobs:
#      auto-merge:
#        runs-on: ubuntu-latest
#        if: github.actor == 'dependabot[bot]'
#        steps:
#          - name: Enable auto-merge for Dependabot PRs
#            run: gh pr merge --auto --squash "$PR_URL"
#            env:
#              PR_URL: ${{github.event.pull_request.html_url}}
#              GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
#
# 4. NOTIFICACIONES:
#    - Configurar notificaciones de Dependabot en Settings > Notifications
#    - Integrar con Slack/Discord para PRs de seguridad
#
# ============================================================================

# ============================================================================
# ESTRATEGIAS DE VERSIONADO
# ============================================================================
#
# - increase: Incrementa versión (default)
# - increase-if-necessary: Solo incrementa si es necesario
# - lockfile-only: Solo actualiza lockfile (package-lock.json, gradle.lockfile)
# - widen: Amplía rango de versiones permitidas
# - auto: Deja que Dependabot decida
#
# ============================================================================

# ============================================================================
# INTERVALOS DE ACTUALIZACIÓN
# ============================================================================
#
# - daily: Diariamente
# - weekly: Semanalmente (recomendado)
# - monthly: Mensualmente
#
# ============================================================================
