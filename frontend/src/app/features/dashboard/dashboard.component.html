<div class="container">
  <div class="dashboard-header">
    <div>
      <h1>Dashboard</h1>
      <p class="text-secondary">Bienvenido, {{ currentUser()?.username }}!</p>
    </div>
    <a routerLink="/tasks/new" class="btn btn-primary">
      + Nueva Tarea
    </a>
  </div>

  @if (loading()) {
    <app-loading></app-loading>
  } @else if (error()) {
    <div class="alert alert-danger">
      {{ error() }}
    </div>
  } @else {
    <!-- Statistics Cards -->
    @if (statistics(); as stats) {
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon total">ğŸ“Š</div>
          <div class="stat-content">
            <div class="stat-label">Total Tareas</div>
            <div class="stat-value">{{ stats.totalTasks }}</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon pending">â³</div>
          <div class="stat-content">
            <div class="stat-label">Pendientes</div>
            <div class="stat-value">{{ stats.pendingTasks }}</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon in-progress">ğŸ”„</div>
          <div class="stat-content">
            <div class="stat-label">En Progreso</div>
            <div class="stat-value">{{ stats.inProgressTasks }}</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon completed">âœ…</div>
          <div class="stat-content">
            <div class="stat-label">Completadas</div>
            <div class="stat-value">{{ stats.completedTasks }}</div>
          </div>
        </div>
      </div>

      <!-- Completion Progress -->
      <div class="card mt-3">
        <div class="card-header">
          <h3>Progreso General</h3>
        </div>
        <div class="card-body">
          <div class="progress-info">
            <span>{{ getCompletionPercentage() }}% Completado</span>
            <span class="text-secondary">
              {{ stats.completedTasks }} de {{ stats.totalTasks }} tareas
            </span>
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar" [style.width.%]="getCompletionPercentage()"></div>
          </div>
        </div>
      </div>
    }

    <!-- Recent Tasks -->
    <div class="card mt-3">
      <div class="card-header">
        <h3>Tareas Recientes</h3>
        <a routerLink="/tasks" class="btn btn-sm btn-outline">Ver Todas</a>
      </div>
      <div class="card-body">
        @if (recentTasks().length === 0) {
          <div class="empty-state">
            <p class="text-secondary">No hay tareas aÃºn</p>
            <a routerLink="/tasks/new" class="btn btn-primary mt-2">
              Crear Primera Tarea
            </a>
          </div>
        } @else {
          <div class="tasks-list">
            @for (task of recentTasks(); track task.id) {
              <div class="task-item" [routerLink]="['/tasks', task.id]">
                <div class="task-info">
                  <div class="task-title">{{ task.title }}</div>
                  @if (task.description) {
                    <div class="task-description">{{ task.description }}</div>
                  }
                </div>
                <div class="task-meta">
                  <span class="badge" [ngClass]="{
                    'badge-warning': task.status === 'PENDING',
                    'badge-primary': task.status === 'IN_PROGRESS',
                    'badge-success': task.status === 'COMPLETED',
                    'badge-secondary': task.status === 'CANCELLED'
                  }">
                    {{ task.status | taskStatus }}
                  </span>
                  <span class="text-secondary task-date">
                    {{ task.createdAt | dateFormat }}
                  </span>
                </div>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }
</div>
